# ステータス仕様_v1_3

> 本書は「ゲーム概要_v2.md」「ダンジョン仕様_v1.md」「武器システム仕様_v1.md」を参照しつつ、> プレイヤーキャラクターのステータス・派生値・状態異常（スタック方式）を v1 として整理する。

- バージョン: v1.3  
- 更新日: 2026-02-08（RunLevel:XP仕様・敵ランク連携 追記）
- 参照: ゲーム概要_v2.md / ダンジョン仕様_v1.md / 武器システム仕様_v1.md

---

## 0. スコープ

本書で定義するもの：
- キャラクターの一次ステータス（6種）
- 派生ステータス（HP/防御/移動/火力など）の計算式（v1 初期案）
- 状態異常（8種）の付与・スタック・減衰・DoT（持続ダメージ）仕様（v1）
- 相性（リアクション）との接続ルール（消費/解除・処理順）

本書で定義しないもの（別仕様）：
- 武器の攻撃周期（クールダウン）、複製（本数増加）、ヒット間隔など：武器システム仕様を参照  
- ダンジョン生成・ポータル・宝箱など：ダンジョン仕様を参照

---

## 1. 用語

- **一次ステータス**：プレイヤー側で保持する「基本能力値」。本書では 6 種。
- **派生ステータス**：一次ステータスや装備・バフから計算される戦闘用の値（HP、防御、移動速度など）。
- **DoT**：Damage over Time（持続ダメージ）。本書では「毎秒ダメージ」として扱う。
- **ティック**：ゲーム内の更新単位。本書では「攻撃ティック（同時発動単位）」と「DoTティック（1秒）」を区別する。
- **ICD**：Internal Cooldown（内部クールダウン）。リアクション等が発生した直後、一定時間は再発動しないための待ち時間。**敵ごとICD**は、敵ごとに独立してICDを持つことを意味する。

---

## 2. 一次ステータス（6種）

> 内部IDは確定：**VIT / FOR / AGI / POW / TEC / ARC**  
> 表示名（日本語/英語）は後で確定してよい（多言語対応のため、内部IDと表示名は分離可能）。

| ID | 役割（v1） | 代表的に影響する派生値 |
|---|---|---|
| VIT | 生命力：最大HP・回復効率の土台 | MaxHP, HealMult |
| FOR | 堅牢/強靭：被ダメ軽減・状態耐性の土台 | DamageReduction, AilmentResist |
| AGI | 機動：移動・被弾しにくさ | MoveSpeed（将来：回避/当たり判定補助） |
| POW | 火力の土台：武器ダメ倍率 | DamageMult |
| TEC | 技量：クリティカル＋武器制御（重心偏り/追従） | CritChance/CritMult, BiasStrength/BiasResponse |
| ARC | 霊性/術式：状態付与・DoT/デバフ・相性（リアクション）側の伸びしろ | AilmentApply, DoT/デバフ係数, ReactionBonus, AilmentResist（補助） |

### 2.1 設計上の禁止事項（バランス保護）
キャラステータスは、以下へ **直接影響させない**（壊れやすい領域のため）。
- 武器の攻撃周期（クールダウン）
- 複製（本数増加）
- リアクションのICD（内部クールダウン）

※上記は「武器/チップ側のビルド要素」として扱う。

---

## 3. 派生ステータスと計算式（v1 初期案）

> 数値は v1 の「初期値（要調整）」として置く。式の形を固定するのが目的。

### 3.1 合成ルール（合算の考え方）
派生値計算に使う一次ステータスは、以下の合計値を使用する。

- `StatTotal = StatBase + StatEquip + StatRun`

ダンジョン仕様より「地上に戻ると HP最大値はリセットされる」ため、HP上昇などのラン内要素は `StatRun` / `RunBonus` として切り分けることを推奨。

---

### 3.1.1 ラン内LV（RunLevel）

- **RunLevel（ラン内LV）**を導入する。
- ダンジョン突入時：`RunLevel = 1` で開始する。
- 地上帰還時：`RunLevel` は **1に戻る**（ラン内進行はリセット）。

#### レベルアップ時の成長（確定仕様：毎回ステータス+1（6択））
- レベルアップするたびに、**以下の6つから1つを選んで +1** する：
  - `VIT / FOR / AGI / POW / TEC / ARC`
- 選んだ +1 は **`StatRun` に加算**される（ラン内のみ有効）。
  - 例：RunLevelが上がって VIT を選択 → `StatRun.VIT += 1`
- ポイントの持ち越し（未使用ポイントの貯蓄）はしない（= レベルアップごとに即時選択）。
- いったん選んだ振り分けは、そのランが終わるまで変更不可（リセット/振り直し無し）。

#### 設計上の注意（バランス保護）
- RunLevel（またはステータス+1）で **武器の攻撃周期（クールダウン）**や**複製（本数増加）**へ直接影響させない（ビルド領域を壊しやすいため）。
- クリティカル率・移動速度・被ダメ軽減などの「壊れやすい派生値」には上限がある前提で運用する（暴れ防止）。

#### 経験値（XP）と必要XP（確定仕様）

RunLevel は **経験値（XP）** により上昇する。  
XP の主目的は「ラン内での段階的な成長（ステータス+1の積み重ね）」であり、武器のクールダウンや複製には直接影響しない。

##### XPの獲得源（v1）
1. **敵撃破XP（メイン）**：敵を倒した瞬間に得る（テンポ優先）
2. **戦闘部屋クリアXP（補助）**：戦闘部屋の最後の敵を倒した時に1回だけ得る
3. **フロアクリアXP（底上げ）**：階段到達（フロア踏破）で1回得る

※宝箱からXPは出さない（報酬の役割分離）。  
※ダメージを与えただけではXPは出さない（多段ヒットで破綻するため）。

##### 敵撃破XP（基準値）
敵の **Rank**（Normal / Elite / Boss）ごとに基礎値を持つ。Rankの詳細は「敵キャラ仕様」を参照。

- `BaseXP(Normal) = 5`
- `BaseXP(Elite) = 18`
- `BaseXP(Boss) = 220`

階層スケール（深い階ほど少し増える）：
- `FloorMult(floor) = 1 + 0.02 * (floor - 1)`
- `XP_enemy = BaseXP(rank) * FloorMult(floor)`

##### 戦闘部屋クリアXP
- `RoomClearXP = round( sum(XP_enemy in room) * 0.20 )`

##### フロアクリアXP
- `FloorClearXP = round( 30 * FloorMult(floor) )`

---

##### 必要XPカーブ（Lv L → L+1）
- `XP_to_next(L) = round( 20 + 5*L + 2*L^2 )`

（目安）しっかり戦うと序盤は **1フロアで2〜4回レベルアップ**、進むほど伸びが鈍る。

- 敵ランク（Normal/Elite/Boss）の詳細は「敵キャラ仕様_v1.md」を参照。

---

### 3.2 最大HP（VIT）
- `MaxHP_base = HP_BASE + VIT * HP_PER_VIT + HP_FLAT`
- `MaxHP = MaxHP_base * (1 + HP_PCT)`

初期値（仮）：
- `HP_BASE = 100`
- `HP_PER_VIT = 8`

（任意）回復効率をVITに寄せる場合：
- `HealMult = 1 + VIT * HEAL_PER_VIT`（例：`HEAL_PER_VIT = 0.005`）

---

### 3.3 防御（FOR）＝被ダメ軽減（逓減）
- `Armor = ARMOR_BASE + FOR * ARMOR_PER_FOR + ARMOR_FLAT`
- `DamageReduction = clamp( Armor / (Armor + K_DEF), 0, DR_CAP )`
- `DamageTaken = RawDamage * (1 - DamageReduction)`

初期値（仮）：
- `ARMOR_BASE = 0`
- `ARMOR_PER_FOR = 3`
- `DR_CAP = 0.75`

`K_DEF` は終盤で硬くなりすぎないため、階層でスケールする形を推奨：
- 例：`K_DEF(floor) = 100 + floor * 15`

---

### 3.4 状態異常耐性（FOR + ARC）
> 「完全無効」よりも、**付与量/持続/効果量を減らす**方向で扱う（安定しやすい）。

- `AilRes = FOR * RES_PER_FOR + ARC * RES_PER_ARC + RES_FLAT`
- `AilmentTakenMult = 1 / (1 + AilRes / K_RES)`（逓減）

利用例：
- 付与量：`apply *= AilmentTakenMult`
- 持続：`durationPerStack *= AilmentTakenMult`（※どちらかに統一でも可）

初期値（仮）：
- `RES_PER_FOR = 1.0`
- `RES_PER_ARC = 0.5`
- `K_RES = 100`
- 下限（推奨）：`AilmentTakenMult >= 0.4`（最大 60% 軽減まで）

---

### 3.5 移動速度（AGI）
- `MoveSpeed = MOVE_BASE * (1 + AGI * MOVE_PER_AGI) * (1 + MoveBonusPct)`
- 上限（推奨）：`MoveSpeed <= MOVE_BASE * 1.5`

初期値（仮）：
- `MOVE_BASE = 1.0`
- `MOVE_PER_AGI = 0.01`（AGI+1で+1%）

---

### 3.6 与ダメ倍率（POW）
- `DamageMult = 1 + POW * DMG_PER_POW`
- `HitDamage_preCrit = WeaponBaseDamage * DamageMult * (1 + ChipDmgPct) * ...`

初期値（仮）：
- `DMG_PER_POW = 0.02`（POW+1で+2%）

---

### 3.7 クリティカル（TEC）
- `CritChance = clamp(CRIT_BASE + TEC * CRIT_PER_TEC + CritBonus, 0, CRIT_CAP)`
- `CritMult = clamp(CRITDMG_BASE + TEC * CRITDMG_PER_TEC + CritDmgBonus, 1.0, CRITDMG_CAP)`

初期値（仮）：
- `CRIT_BASE = 0.05`
- `CRIT_PER_TEC = 0.003`
- `CRIT_CAP = 0.40`
- `CRITDMG_BASE = 1.50`
- `CRITDMG_PER_TEC = 0.01`
- `CRITDMG_CAP = 2.50`

---

### 3.8 武器制御（TEC）：重心偏り＆追従
武器軌道は「クリック方向ベクトルに応じて重心（密度）が偏る」仕様を持つ。  
TEC はこの“偏り量”と“追従速度”に作用させ、プレイングによる差を作る。

- `BiasStrength = BiasStrengthBase * (1 + TEC * BIAS_PER_TEC)`（偏りの強さ）
- `BiasResponse = BiasResponseBase * (1 + TEC * RESPONSE_PER_TEC)`（追従の速さ）
- 上限（推奨）：それぞれ `cap` を設ける（挙動破綻防止）

初期値（仮）：
- `BIAS_PER_TEC = 0.01`
- `RESPONSE_PER_TEC = 0.01`

---

### 3.9 ダメージ計算の順序（弱点なし前提）
弱点倍率（背面/部位など）を作らない前提で、v1は以下で固定する。

1. **基礎（武器側）**：`WeaponBaseDamage`
2. **キャラ倍率（POW）**：`DamageMult`
3. **チップ等の倍率**：`(1 + ChipDmgPct)` など
4. **クリティカル（TEC）**：当選時のみ `* CritMult`
5. **デバフ（脆化など）**：`* (1 + VulnerablePct)` など
6. **リアクション追加ダメ/倍率（ARC）**：リアクション処理で別途加算 or 乗算（※リアクション表の定義に従う）

---

## 4. 状態異常（スタック方式）仕様 v1

### 4.1 状態異常の一覧（8種）
1. 出血（物理：DoT、スタック）
2. 中毒（毒：DoT、スタック）
3. 燃焼（炎：DoT、スタック）
4. 冷却（氷：移動/攻撃速度低下、スタック）
5. 凍結（冷却が閾値で昇格：短時間停止）
6. 感電（雷：追加ダメ/連鎖の素、スタック）
7. 麻痺（感電が閾値で昇格：短時間スタン）
8. 脆化（被ダメ上昇：主に相性で付与）

### 4.2 処理順（同時発動に対応）
1回の攻撃ティック内は以下で固定：

1. **このティックで付与される状態異常をいったん適用**
2. **リアクション表をチェックして発生**

（これにより「炎＋毒が同時に当たった」でも爆燃などが成立）

---

### 4.3 敵が持つ状態データ（最小）
状態ごとに以下を保持する（DoT系は追加で保持）。

共通：
- `stacks: int`
- `decayTimer: float`（次に1スタック減るまで）
- `applyRemainder: float`（付与端数）

DoT系（出血/中毒/燃焼）：
- `dotTimer: float`（0〜1秒を周回）
- `dotPerStack: float`（1スタックあたりの「毎秒」ダメージ）

---

### 4.4 スタック付与（端数方式：+99対策）
付与量は float で貯め、**1.0 ごとに 1スタック**増える。

- `apply = ApplyBase * ApplyMult(plus) * (1 + ARC * A_APPLY) * AilmentTakenMult`
- `applyRemainder += apply`
- `addStacks = floor(applyRemainder)`
- `applyRemainder -= addStacks`
- `stacks = min(stacks + addStacks, maxStacks)`
- `if addStacks > 0: decayTimer = durationPerStack`（付与が入ったら減衰タイマー更新）

#### 付与倍率（plus）のおすすめ：逓減
+値が大きくても破綻しにくい逓減式を推奨：

- `ApplyMult(plus) = 1 + MAX * plus / (plus + HALF)`

初期値（仮）：
- `MAX = 3.0`
- `HALF = 25`

---

### 4.5 スタック減衰（1個ずつ落ちる）
- `decayTimer -= dt`
- `decayTimer <= 0` になったら：
  - `stacks -= 1`
  - `stacks > 0` の場合：`decayTimer = durationPerStack`
  - `stacks == 0`：状態解除（dotTimer等も初期化）

---

### 4.6 DoT（持続ダメージ）：1秒ティック
DoTは **1秒ごと**に発生する。

- `dotTimer += dt`
- `while dotTimer >= 1.0: dotTimer -= 1.0; DealDamage(dotPerStack * stacks)`

#### dotPerStack の作り方（クリ二重取りを避ける）
DoTは「付与した瞬間の非クリ基準ヒット」から作る（スナップショット扱い）。

- `BaseHitNonCrit = そのヒットの最終ダメ（クリ無し）`
- `addedDotPerStack = BaseHitNonCrit * DOT_COEF[type] * (1 + ARC * A_DOT)`
- `dotPerStack` はスタック加重平均で更新する（強い付与が反映されるが暴れにくい）：

```
dotPerStack = (dotPerStack*oldStacks + addedDotPerStack*addStacks) / (oldStacks + addStacks)
```

---

### 4.7 昇格（冷却→凍結 / 感電→麻痺）
付与フェーズの最後に閾値をチェックし、条件を満たしたら昇格する。

- 冷却：`stacks >= FreezeThreshold` → **凍結**（冷却は 0 にリセット推奨）
- 感電：`stacks >= ParalyzeThreshold` → **麻痺**（感電は 0 にリセット推奨）

CC連打防止（推奨）：
- 凍結終了後：`FreezeImmunity = 3s`（Normal/Elite）／`6s`（Boss）
- 麻痺終了後：`ParalyzeImmunity = 3s`（Normal/Elite）／`6s`（Boss）

※ランク別のCC免疫時間の詳細は「敵キャラ仕様_v1_4.md」6.3節を参照。

---

## 5. 状態異常パラメータ表（v1 初期値）

> ここは「まず固定して、触り心地で調整」する領域。

### 5.1 スタック状態（6種）
| 状態 | 属性 | maxStacks | durationPerStack | 効果 |
|---|---|---:|---:|---|
| 出血 | 物理 | 8 | 6s | DoT（毎秒）：非クリ基準×`0.07`×stacks |
| 中毒 | 毒 | 12 | 8s | DoT（毎秒）：非クリ基準×`0.05`×stacks（リアクション燃料） |
| 燃焼 | 炎 | 10 | 5s | DoT（毎秒）：非クリ基準×`0.06`×stacks |
| 冷却 | 氷 | 6 | 6s | 移動-6%/stack（上限-40%）＋攻撃速度-4%/stack（上限-30%） |
| 感電 | 雷 | 8 | 6s | 雷ヒット時：そのヒット（非クリ）の `+4%×stacks`（上限+30%） |
| 脆化 | 相性 | 6 | 5s | 被ダメ+6%/stack（上限+30%） |

### 5.2 昇格（CC）状態（2種）
| 状態 | 発生元 | 条件 | 持続 | 効果 |
|---|---|---|---:|---|
| 凍結 | 冷却 | 冷却スタック≧5 | 1.2s | 行動停止（融解/破砕で解除され得る） |
| 麻痺 | 感電 | 感電スタック≧6 | 0.8s | スタン |

---

## 6. リアクション（相性）との接続（v1）

リアクションは「敵ごとICD」「1ティック1回」「優先度で決定」を前提とする（詳細は武器システム仕様）。

ここでは **状態の消費/解除**のみ明記する。

| リアクション | 条件 | 消費/解除（推奨） |
|---|---|---|
| 毒×氷→脆化 | 中毒中に氷 | 中毒 -1、脆化付与 |
| 炎×毒→爆燃 | 中毒中に炎 | 中毒 -2〜3、爆発＋燃焼付与 |
| 炎×氷→融解 | 冷却/凍結中に炎 | 冷却/凍結解除（高倍率単体） |
| 物理×凍結→破砕 | 凍結中に物理 | 凍結解除（小範囲） |
| 雷×氷→破砕導電 | 冷却/凍結中に雷 | 感電を周囲へ拡散（集団処理寄り） |
| 雷×毒→神経毒 | 中毒中に雷 | 中毒は消費しない（代わりに効果量控えめ） |

---

## 7. 調整用パラメータ（一覧）

### 7.1 一次→派生
- `HP_BASE`, `HP_PER_VIT`
- `ARMOR_PER_FOR`, `K_DEF`, `DR_CAP`
- `MOVE_PER_AGI`
- `DMG_PER_POW`
- `CRIT_PER_TEC`, `CRITDMG_PER_TEC`, `CRIT_CAP`, `CRITDMG_CAP`
- `BIAS_PER_TEC`, `RESPONSE_PER_TEC`
- `RES_PER_FOR`, `RES_PER_ARC`, `K_RES`

### 7.2 状態異常
- `ApplyBase[type]`, `DOT_COEF[type]`
- `A_APPLY`, `A_DOT`
- `maxStacks[type]`, `durationPerStack[type]`
- `FreezeThreshold`, `ParalyzeThreshold`
- `FreezeImmunity`, `ParalyzeImmunity`

---

## 8. TODO（次に決めること）
- 一次ステータスの表示名（日本語/英語）確定
- ARCの係数の割り振り（付与量/DoT/デバフ/リアクション倍率の比率）
- 「感電」の具体表現（連鎖 or 追加ダメのどちらに寄せるか）と実装方式
- 防御の `K_DEF` スケール（階層/敵ランク/難易度でのカーブ）