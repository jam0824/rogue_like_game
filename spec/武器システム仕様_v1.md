# 武器システム仕様

本ドキュメントは、ゲーム全体仕様「ゲーム概要.md」から**武器に関する仕様を切り出し**、武器・スキルチップ・武器軌道（フォーメーション）・属性/状態異常/相性（リアクション）を中心にまとめたもの。

---

## 1. 用語

- **武器枠**：プレイヤーが装備できる武器スロット。武器枠ごとに攻撃周期（クールダウン）を持つ。
- **武器オブジェクト**：画面上で実際に動き、敵に当たって攻撃判定を出す「剣など」の実体。
- **スキルチップ**：武器に装着する強化・効果付与パーツ。パッシブ/攻撃/軌道/複製/相性強化などを含む。
- **フォーメーション**：武器オブジェクトの動き（軌道）の種類。スキルチップとは別枠の特性。
- **軌道パラメータ**：回転半径・速度・位相ずれなど、フォーメーションを数値的に改造する要素。
- **属性**：攻撃効果のカテゴリ（炎・氷など）。相性（リアクション）の入力になる。
- **状態異常**：敵に付与される継続効果（燃焼・中毒など）。相性（リアクション）の条件になる。
- **リアクション（相性）**：属性/状態の組み合わせで発生する追加効果（爆燃・脆化など）。

---

## 2. 武器の基本仕様

### 2.1 入手と所持
- ダンジョンで武器を拾うことができる。
- 初期武器所持数（＝武器枠数）は **1**。
- 武器は最大 **8本**まで持てる（武器枠最大数）。
- 特定階到達で、地上施設のショップにより武器枠を増やせる。

### 2.2 武器データ構造（最低限）
武器は以下を持つ。

- **スキルチップスロット**（複数）
- **フォーメーション枠**（1つ。軌道特性）
- **デフォルトスキルチップ**（初期付与）
- **デフォルトフォーメーション**（初期付与）
- **攻撃周期（クールダウン）**
- （任意）レアリティ、基礎攻撃力、初期属性など

---

## 3. 攻撃とヒット判定

### 3.1 自動攻撃
- キャラクターに攻撃モーションは無い。
- プレイヤーの周囲に武器オブジェクトが浮遊し、**自動で動いて敵を攻撃**する。
- 攻撃入力は不要で、武器ごとの攻撃周期で常時攻撃が行われる。

### 3.2 同時発動ルール
- 武器に複数の属性・攻撃スキルが載っている場合、**攻撃時に全て同時に発動**する。
- 軌道チップ・複製チップもスキルとして扱い、装着中は常時効果を持つ。

### 3.3 ヒット間隔（同一敵への多段抑制）
- 「ヒット間隔」は同一敵へ連続ヒットできる最短間隔（例：0.2sなど）を表す。
- **同一武器から生成された複数本（複製）**は、同一敵へのヒット間隔を共有する（瞬間多段の破綻防止）。

---

## 4. 武器軌道システム（フォーメーション）

### 4.1 フォーメーションの位置づけ
- 各武器は「フォーメーション」を1つ持つ。
- フォーメーションはスキルチップとは**別枠**（ビルドの別レイヤー）。
- フォーメーションにより、カバー範囲・得意距離・戦術が変わる。

### 4.2 フォーメーション一覧（初期実装候補）
- **円周**：周囲制圧の安定型
- **前方扇形**：狙い撃ち・前方集中
- **後方護衛**：背面ケア・逃げ撃ち
- **8の字**：前後往復・多方向対応
- **壁沿いバウンド**：地形依存の跳弾軌道

### 4.3 クリック方向の意味付け（重心移動）
- プレイヤーはマウスクリック方向へ移動する。
- クリック方向ベクトルに応じて、武器軌道の**重心（中心/密度）が偏る**。
  - 攻撃寄り：前方に偏る（前方扇形などが強化される）
  - 防御寄り：後方に偏る（後方護衛などが強化される）
- 操作（移動）そのものが戦術になる。

---

## 5. 軌道パラメータと軌道チップ

### 5.1 代表的な軌道パラメータ
- **回転半径**：武器が回る距離
- **回転速度**：武器が回る速さ
- **位相ずれ**：複数本の配置間隔（密集/拡散）
- **貫通回数**：敵を貫く回数
- **ヒット間隔**：同一敵への連続ヒット最短間隔

### 5.2 軌道チップ（例）
- 回転半径+
- 回転速度+
- 位相ずれ+（密集/拡散の方向性をチップで分けてもよい）
- 貫通回数+
- ヒット間隔-（短縮）

### 5.3 体感の指針（見た目変化を重視）
- 数値上昇は、可能な限り**視覚的変化**（密度・広がり・残像など）を伴う。
- 本数増加（複製）と位相ずれは特に「増えた感」が出るため優先的に演出を入れる。

---

## 6. 本数増加（複製チップ）

### 6.1 目的
- 武器1本につき n 本へ増やし、見た目の爽快感と面制圧力を上げる。
- ただし無制限のDPS増加を防ぐため、ルールで抑制する。

### 6.2 仕様
- 「複製」スキルチップを装着すると、その武器枠から生成される武器オブジェクト本数が増える。
- **1武器につき複製チップは1枚のみ装着可能**
- **複製の+上限は3**
- 生成本数：`n = 1 + 複製の+値`
  - 複製+1 → 2本
  - 複製+2 → 3本
  - 複製+3 → 4本
- 生成された複数本は、位相ずれに応じて配置される。

### 6.3 攻撃周期・ヒット間隔の共有
- 同一武器から生成された複数本（複製）は、**同じ攻撃周期（クールダウン）を共有**する。
- 同一武器コピー同士は、**同一敵へのヒット間隔を共有**する（瞬間多段の抑制）。

### 6.4 本数増加時の逓減補正（推奨初期式）
- 本数増加は総ダメージが逓減補正される。
- 推奨初期式（調整可能）：
  - 総ダメ倍率 `= 1 + 0.6×(n-1)`
  - 1本あたりの係数 `= 総ダメ倍率 / n`
  - 例：
    - 2本：総1.6倍（1本0.8倍）
    - 3本：総2.2倍（1本0.733倍）
    - 4本：総2.8倍（1本0.7倍）

---

## 7. スキルチップ仕様

### 7.1 チップ分類
- **パッシブチップ**：常時発動（攻撃力+%など）
- **攻撃チップ**：攻撃時に発動（属性付与、状態付与、追加弾など）
- **軌道チップ**：軌道パラメータを改造（回転半径+など）
- **複製チップ**：本数増加（複製+）
- **相性強化チップ（任意）**：特定リアクションを伸ばす（例：爆燃の範囲+）

### 7.2 タグ設計（相性の前提）
各チップは最低限以下のタグを持つ。

- **属性タグ**：物理 / 炎 / 氷 / 毒 / 雷
- **付与状態タグ**：燃焼、中毒…など（付与する状態異常）

---

## 8. 属性・状態異常・相性（リアクション）

### 8.1 属性（5種）
- 物理
- 炎
- 氷
- 毒
- 雷  
（将来拡張の6種目は温存）

### 8.2 状態異常（8種）
1. **出血**（物理：DoT、スタック）
2. **中毒**（毒：DoT、スタック）
3. **燃焼**（炎：DoT、スタック）
4. **冷却**（氷：移動/攻撃速度低下、スタック）
5. **凍結**（冷却が閾値で昇格：短時間停止）
6. **感電**（雷：追加ダメ/連鎖の素、スタック）
7. **麻痺**（感電が閾値で昇格：短時間スタン）
8. **脆化**（被ダメ上昇：主に相性で付与）

### 8.3 相性（リアクション）判定手順（同時発動に対応）
- 1回の攻撃ティックで複数効果が同時発動することを前提に、以下の順で処理する。
  1. **このティックで付与される状態異常をいったん適用**
  2. **リアクション表をチェックして発生**
- これにより「炎＋毒を同時に当てた」場合でも爆燃が成立する。

### 8.4 リアクション表（初期コア案）
※数値は後で調整。まずは「体験の役割」を固定する。

- **毒（中毒）× 氷 → 脆化**
  - 条件：中毒中の敵に氷が当たる（同ティック可）
  - 効果：脆化付与（短時間の火力窓）
  - 消費：中毒スタックを1消費（推奨）
- **炎 × 毒（中毒） → 爆燃**
  - 条件：中毒中の敵に炎（同ティック可）
  - 効果：即時爆発ダメ＋小範囲、燃焼付与
  - 消費：中毒スタックを2〜3消費（推奨）
- **炎 × 氷（冷却/凍結） → 融解**
  - 条件：冷却/凍結中に炎
  - 効果：高倍率単体ダメ（凍結解除＝安全と引き換え）
- **物理 × 氷（凍結） → 破砕**
  - 条件：凍結中に物理
  - 効果：破砕ダメ＋小範囲（凍結解除）
- **雷 × 氷（冷却/凍結） → 破砕導電**
  - 条件：冷却/凍結中に雷
  - 効果：感電を周囲へ拡散、チェイン強化など（集団処理寄り）
- **雷 × 毒（中毒） → 神経毒**
  - 条件：中毒中に雷
  - 効果：感電付与量+／麻痺しやすく（制御寄り）
  - 消費：中毒は消費しない（推奨：代わりに効果量控えめ）

### 8.5 暴れ防止の共通ルール（必須）
- **リアクションは敵ごとにICD（内部クールダウン）**を持つ（例：0.7秒）
- **1ティックにつき同一敵は最大1リアクション**（優先度で決定）
  - 優先度例：爆燃 ＞ 融解 ＞ 破砕導電 ＞ 破砕 ＞ 脆化 ＞ 神経毒

---

## 9. 武器合成

- ダンジョンで武器合成アイテムを拾うことができる。
- 合成時は、ベース武器のスロット分だけスキルチップを載せることができる。
- 同じスキルを持った武器を合成すると、そのスキルは+になる（毒+1など）。
- +は99まで。
  - 例外：**複製は+上限3**
- 合成時のフォーメーション：
  - ベース武器のフォーメーションを引き継ぐ（フォーメーションは別枠で変更する想定）

---

## 10. 武器の強化（精錬所）

- 精錬所で武器を鍛えることができる。
- 強化すると武器が+になる（+99まで）。

---

## 11. 武器のロストと再取得

- 死ぬと手持ちのアイテムは全てロストする。
- ロストした武器は、死んだ階以降で敵から再度取得できる。
- 再取得した武器のスキルやアップグレード状態は、死んだときのまま維持される。

---

## 12. 他システムとの接続（最小限）

- **テイムしたモンスター**は武器枠扱い（自動攻撃する武器として振る舞う）。
  - モンスターにもスキルを付けられる（チップ適用ルールは武器に準ずる）。
  - HPを持ち、死んだら復活しない（武器とは異なる制約）。

---

## 13. 実装・調整の主なノブ（後で詰める項目）

- 1武器あたりのスキルチップスロット数
- フォーメーションの入手方法（武器固有/チップ/付与アイテム）
- 各状態異常のスタック上限・持続時間・効果量
- リアクションICD・優先度・消費量
- 逓減式の係数（0.6部分）と武器別の例外
- クリック方向の重心移動量（攻撃寄り/防御寄りの度合い）
